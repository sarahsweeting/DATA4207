dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate)
county.data %>%
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool))
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool))
View(main.data)
View(drugs.mort.data)
View(poverty.data)
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate)
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate))
main.data <- merge(
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool))
main.data <- merge(
main.data %>%
dply::select(Id2, county, mortality.rate, below.poverty.rate)
county.data %>%
main.data <- merge(
main.data %>%
dply::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool))
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool))
)
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
dplyr::select(Id2, county.state, education.highschool)
)
View(main.data)
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
mutate(z.highschool = (education.highschool - mean(education.highschool, na.rm=T)) /
sd(education.highschool, na.rm=T)),
dplyr::select(Id2, county.state, z.highschool)
)
View(county.data)
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
mutate(z.highschool = (education.highschool - mean(education.highschool, na.rm=T)) /
sd(education.highschool, na.rm=T)) %>%
dplyr::select(Id2, county.state, z.highschool)
)
levels(as.factor(main.data$county.state))
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = county.data)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
main.data <- merge(
main.data  %>%
mutate(z.poverty = (below.poverty.rate - mean(below.poverty.rate, na.rm=T)) /
sd(below.poverty.rate, na.rm=T)),
opioids.data %>%
dplyr::rename(Id2 = FIPS.County.Code) %>%
mutate(z.opiates = (X2016.Prescribing.Rate - mean(X2016.Prescribing.Rate, na.rm=T)) /
sd(X2016.Prescribing.Rate, na.rm=T)) %>%
dplyr::select(Id2, z.opiates, X2016.Prescribing.Rate))
main.data = drop_na(main.data, mortality.rate)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
main.data = drop_na(main.data, mortality.rate, z.poverty, z.opiates, z.highschool)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
head(main.data)
levels(as.factor(main.data$mortality.rate))
main.data <- main.data %>%
mutate(mortality.rate = ifelse(mortality.rate == 'Unreliable',
NA, as.numeric(as.character(mortality.rate))))
main.data = drop_na(main.data, mortality.rate, z.poverty, z.opiates, z.highschool)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
# Summarise the regression model
summary(regmodel)
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
View(fip.concordance)
View(fip.concordance)
View(county.data)
View(main.data)
View(opioids.data)
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
head(opiods.data$FIPS.Countycode)
View(opioids.data)
View(fip.concordance)
View(opioids.data)
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
head(opiods.data$FIPS.County.Code)
opioids.data <- read.csv("US data for group task/opioids/opioids prescribing rates.csv")
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
head(opiods.data$FIPS.County.Code)
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
head(opioids.data$FIPS.County.Code)
head(main.data)
View(opioids.data)
head(main.data)
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.a.high.school.diploma.only.2014.18) %>%
mutate(z.highschool = (education.highschool - mean(education.highschool, na.rm=T)) /
sd(education.highschool, na.rm=T)) %>%
dplyr::select(Id2, county.state, education.highschool, z.highschool)
)
head(main.data)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
View(main.data)
main.data <- merge(
main.data  %>%
mutate(z.poverty = (below.poverty.rate - mean(below.poverty.rate, na.rm=T)) /
sd(below.poverty.rate, na.rm=T)),
opioids.data %>%
dplyr::rename(Id2 = FIPS.County.Code) %>%
mutate(z.opiates = (X2016.Prescribing.Rate - mean(X2016.Prescribing.Rate, na.rm=T)) /
sd(X2016.Prescribing.Rate, na.rm=T)) %>%
dplyr::select(Id2, z.opiates, X2016.Prescribing.Rate))
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool + county.state, data = main.data)
summary(regmodel)
View(county.data)
levels(as.factor(main.data$county.state))
count(main.data$county.state)
View(county.data)
View(main.data)
tabyl(main.data, county.state, mortality.rate)
install.packages("janitor")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(janitor)
tabyl(main.data, county.state, mortality.rate)
tabyl(main.data, county.state)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + county.state, data = main.data)
summary(regmodel)
View(main.data)
View(main.data)
regmodel <- lm(mortality.rate ~ below.poverty.rate + X2016.Prescribing.Rate + education.highschool + county.state, data = main.data)
summary(regmodel)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
load(
"US data for group task/Other census data/county.data.RData")
poverty.data <- read.csv(
"US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
drugs.mort.data <- read.table(
"US data for group task/mortality/Drugs and alcohol Cause of Death, 1999-2016.txt",
sep = '\t', header = T)
opioids.data <- read.csv("US data for group task/opioids/opioids prescribing rates.csv")
us.shape.1 <-
st_read("US data for group task/US shapefiles/cb_2016_us_county_20m.shp")
fip.concordance <- read.csv("US data for group task/fips concordance.csv")
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
head(county.data$FIPS)
head(opioids.data$FIPS.County.Code)
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate))
main.data <- merge(
main.data %>%
dplyr::select(Id2, county, mortality.rate, below.poverty.rate),
county.data %>%
dplyr::rename(Id2 = FIPS,
county.state = State,
education.highschool = Percent.of.adults.with.less.than.a.high.school.diploma.2014.18) %>%
mutate(z.highschool = (education.highschool - mean(education.highschool, na.rm=T)) /
sd(education.highschool, na.rm=T)) %>%
dplyr::select(Id2, county.state, education.highschool, z.highschool)
)
main.data <- merge(
main.data  %>%
mutate(z.poverty = (below.poverty.rate - mean(below.poverty.rate, na.rm=T)) /
sd(below.poverty.rate, na.rm=T)),
opioids.data %>%
dplyr::rename(Id2 = FIPS.County.Code) %>%
mutate(z.opiates = (X2016.Prescribing.Rate - mean(X2016.Prescribing.Rate, na.rm=T)) /
sd(X2016.Prescribing.Rate, na.rm=T)) %>%
dplyr::select(Id2, z.opiates, X2016.Prescribing.Rate))
head(main.data)
levels(as.factor(main.data$mortality.rate))
main.data <- main.data %>%
mutate(mortality.rate = ifelse(mortality.rate == 'Unreliable',
NA, as.numeric(as.character(mortality.rate))))
us.shape.2 <- us.shape.1 %>%
merge(fip.concordance %>%
mutate(STATEFP =  ifelse(Numeric.code >= 0 & Numeric.code <= 9,
paste0(0 , Numeric.code), Numeric.code)) %>%
dplyr::rename(state = Alpha.code))
us.shape.2$county <- paste0(us.shape.2$NAME, ", ", us.shape.2$state)
us.shape.2$county <- gsub("Doña Ana, NM", "Dona Ana, NM", us.shape.2$county)
us.shape.2$county <- gsub("LaSalle, LA", "La Salle, LA", us.shape.2$county)
us.shape.2$county <- gsub("Oglala Lakota, SD", "Oglala, SD", us.shape.2$county)
us.shape.2 <- full_join(us.shape.2,
main.data %>%
dplyr::select(county, below.poverty.rate, mortality.rate, X2016.Prescribing.Rate)) %>%
st_as_sf() # To acknolwedge its a shape file
main.data = drop_na(main.data, mortality.rate, z.poverty, z.opiates, z.highschool)
cannabis_legality <- data.frame(
county.state = c("AL", "AK", "AZ", "AR", "CA",
"CO", "CT", "DE", "FL", "GA",
"HI", "ID", "IL", "IN", "IA",
"KS", "KY", "LA", "ME", "MD",
"MA", "MI", "MN", "MS",
"MO", "MT", "NE", "NV", "NH",
"NJ", "NM", "NY", "NC",
"ND", "OH", "OK", "OR", "PA",
"RI", "SC", "SD", "TN",
"TX", "UT", "VT", "VA", "WA",
"WV", "WI", "WY", "DC"),
Legality_Status = c("Legal for Medical Only", "Legal for Medical and Recreational",
"Legal for Medical and Recreational", "Legal for Medical Only",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Legal for Medical and Recreational", "Decriminalized",
"Legal for Medical Only", "Legal for Medical Only",
"Legal for Medical Only", "Illegal", "Legal for Medical and Recreational",
"Decriminalized", "Legal for Medical Only",
"Decriminalized", "Decriminalized", "Decriminalized",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Legal for Medical Only", "Legal for Medical Only",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Decriminalized", "Legal for Medical and Recreational",
"Decriminalized", "Legal for Medical and Recreational",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Decriminalized", "Illegal", "Legal for Medical Only",
"Decriminalized", "Legal for Medical and Recreational",
"Decriminalized", "Legal for Medical and Recreational",
"Legal for Medical Only", "Legal for Medical and Recreational",
"Decriminalized", "Legal for Medical Only",
"Decriminalized", "Legal for Medical and Recreational",
"Legal for Medical and Recreational", "Legal for Medical and Recreational",
"Decriminalized", "Decriminalized", "Illegal",
"Legal for Medical and Recreational")
)
legalplus.main.data = merge(main.data, cannabis_legality, by = "county.state", all = TRUE)
ggplot(main.data, aes(x = mortality.rate)) +
geom_histogram(bins = 30, fill = "blue", color = "black") +
ggtitle("Distribution of Mortality Rates") +
xlab("Mortality Rate") +
ylab("Frequency")
ggplot(legalplus.main.data, aes(x = Legality_Status, y = mortality.rate, fill = Legality_Status)) +
geom_boxplot() +
ggtitle("Mortality Rate vs Cannabis Legality Status") +
xlab("Cannabis Legality Status") +
ylab("Mortality Rate")
ggplot(main.data, aes(x = z.poverty, y = mortality.rate)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm", se = FALSE, color = "red") +
ggtitle("Mortality Rate vs. Poverty Rate") +
xlab("Below Poverty Rate") +
ylab("Mortality Rate")
ggplot(main.data, aes(x = z.highschool, y = mortality.rate)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm", se = FALSE, color = "blue") +
ggtitle("High School Rates vs. Mortality Rate") +
xlab("High School Rates") +
ylab("Mortality Rate")
ggplot(main.data, aes(x = z.opiates, y = mortality.rate)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm", se = FALSE, color = "green") +
ggtitle("Mortality Rate vs. Opiate use") +
xlab("Opiate use") +
ylab("Mortality Rate")
ggplot(legalplus.main.data, aes(x = X2016.Prescribing.Rate, y = mortality.rate)) +
geom_point(aes(color = Legality_Status), alpha = 0.6) +
geom_smooth(method = "lm", se = FALSE) +
facet_wrap(~Legality_Status) +
ggtitle("Perscription Rates vs. Mortality Rate by Cannabis Legality Status") +
xlab("Perscription Rate") +
ylab("Mortality Rate")
numeric.data <- data.frame(main.data$z.poverty, main.data$z.opiates, main.data$mortality.rate, main.data$z.highschool)
cormat <- round(cor(numeric.data),2)
head(cormat)
library(reshape2)
melted_cormat <- melt(cormat)
ggplot(data = melted_cormat, aes(Var2, Var1, fill = value))+
geom_tile(color = "white")+
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1,1), space = "Lab",
name="Pearson\nCorrelation") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, vjust = 1,
size = 12, hjust = 1))+
coord_fixed()
legalplus.main.data = drop_na(legalplus.main.data, mortality.rate, z.poverty, z.opiates, z.highschool, Legality_Status)
model1 <- lm(mortality.rate ~ z.poverty + z.opiates, data = main.data)
summary(model1)
regmodel <- lm(mortality.rate ~ z.poverty + z.opiates + z.highschool  + Legality_Status, data = legalplus.main.data)
summary(regmodel)
residuals <- resid(model1)
fitted_values <- fitted(model1)
plot(fitted_values, residuals, main = "Residuals vs Fitted Values",
xlab = "Fitted Values", ylab = "Residuals")
abline(h = 0, col = "red")
qqnorm(residuals)
qqline(residuals)
us.shape.2 <- us.shape.2 %>%
shift_geometry() #This function moves alaska into a easier area to interpret
p1 <- ggplot(us.shape.2) +
geom_sf(mapping = aes(fill = mortality.rate), colour = NA, inherit.aes = FALSE) +
scale_fill_gradient2(low = "dark blue",
high = "dark green",
midpoint = mean(us.shape.2$mortality.rate, na.rm = TRUE),
limits = c(min(us.shape.2$mortality.rate, na.rm = TRUE),
max(us.shape.2$mortality.rate, na.rm = TRUE)),
label = scales::comma,
na.value = "grey") +
labs(title = 'Mortality Rate distribution') +
guides(fill = guide_legend(keyheight = 0.3)) +
theme_void() +
theme(plot.title = element_text(size = 7),
legend.position = 'bottom',
legend.title = element_blank())
p2 <- ggplot(us.shape.2) +
geom_sf(mapping = aes(fill = below.poverty.rate), colour = NA, inherit.aes = FALSE) +
scale_fill_gradient2(low = "dark blue",
high = "dark green",
midpoint = mean(us.shape.2$below.poverty.rate, na.rm = TRUE),
limits = c(min(us.shape.2$below.poverty.rate, na.rm = TRUE),
max(us.shape.2$below.poverty.rate, na.rm = TRUE)),
label = scales::comma,
na.value = "grey") +
labs(title = 'Poverty Rate distribution') +
guides(fill = guide_legend(keyheight = 0.3)) +
theme_void() +
theme(plot.title = element_text(size = 7),
legend.position = 'bottom',
legend.title = element_blank())
p3 <- ggplot(us.shape.2) +
geom_sf(mapping = aes(fill = X2016.Prescribing.Rate), colour = NA, inherit.aes = FALSE) +
# coord_sf(xlim = c(-180, -65), ylim = c(24, 72), expand = FALSE) +
scale_fill_gradient2(low = "dark blue",
high = "dark green",
midpoint = mean(us.shape.2$X2016.Prescribing.Rate, na.rm = TRUE),
limits = c(min(us.shape.2$X2016.Prescribing.Rate, na.rm = TRUE),
max(us.shape.2$X2016.Prescribing.Rate, na.rm = TRUE)),
label = scales::comma,
na.value = "grey") +
labs(title = 'Opiates Prescription Rate distribution') +
guides(fill = guide_legend(keyheight = 0.3)) +
theme_void() +
theme(plot.title = element_text(size = 7),
legend.position = 'bottom',
legend.title = element_blank())
p1 +p2 + p3 +
plot_annotation(title = 'Demographic distribution in America') +
plot_layout(ncol = 3,widths = c(0.8,0.7,1.2))
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
tinytex::reinstall_tinytex(repository = "illinois")
p1 +p2 + p3 +
plot_annotation(title = 'Demographic distribution in America') +
plot_layout(ncol = 3,widths = c(0.8,0.7,1.2))
p1 +p2 + p3 +
plot_annotation(title = 'Demographic distribution in America') +
plot_layout(ncol = 3,widths = c(0.8,0.7,1.2))
knitr::opts_chunk$set(echo = TRUE, ,
results = "hide")
knitr::opts_chunk$set(echo = TRUE,
results = "hide")
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
knitr::opts_chunk$set(echo = TRUE, warnings = FALSE,
results = "hide")
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
knitr::opts_chunk$set(echo = FALSE, message= FALSE, warnings = FALSE,
results = "hide")
library(tidyverse)
library(sf)
library(janitor)
library(sf)
library(scales)
library(patchwork)
library(ggplot2)
library(rmapshaper)
library(tigris)
