knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) # piping and cleaning logic
library(readxl)
library(scales) #scaling graphs
file.path <- paste0('data/religion/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('Data/religion/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('religion data/religion/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('religion/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('/religion')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('/religion data')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('/religion data/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
file.path <- paste0('religion data/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
df_input_list[[1]] #need double square brackets to just see the table
df_merged <- bind_rows(df_input_list)
df_merged <- bind_rows(df_input_list)
dim(df_merged)
religion.data <- df_merged %>%
filter(Name %in% grep('District -',
df_merged$Name, value = T) &
!Name %in% grep('Sub-District -', df_merged$Name, value = T) &
Religion != 'Total' & TRU != 'Total') %>%
mutate(district = gsub('District - ', '', Name))
religion.data <- religion.clean.data %>%
group_by(district) %>%
mutate(prop = TOT_P / sum(TOT_P)) %>%
dplyr::select(district,
religion = Religion,
urban.rural = TRU,
n = TOT_P,
prop)
religion.clean.data <- df_merged %>%
filter(Name %in% grep('District -',
df_merged$Name, value = T) &
!Name %in% grep('Sub-District -', df_merged$Name, value = T) &
Religion != 'Total' & TRU != 'Total') %>%
mutate(district = gsub('District - ', '', Name))
religion.data <- religion.clean.data %>%
group_by(district) %>%
mutate(prop = TOT_P / sum(TOT_P)) %>%
dplyr::select(district,
religion = Religion,
urban.rural = TRU,
n = TOT_P,
prop)
religion.data
View(religion.data)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) # piping and cleaning logic
library(readxl)
library(scales) #scaling graphs
file.path <- paste0('religion data/')
filelist = list.files(path = file.path, pattern="*.xlsx$")
#creates df input list
df_input_list <- lapply(paste0(file.path, filelist), read_xlsx)
df_input_list[[1]] #need double square brackets to just see the table because its a list of dataframes
df_merged <- bind_rows(df_input_list)
dim(df_merged)
religion.clean.data <- df_merged %>%
filter(Name %in% grep('District -',
df_merged$Name, value = T) &
!Name %in% grep('Sub-District -', df_merged$Name, value = T) &
Religion != 'Total' & TRU != 'Total') %>%
mutate(district = gsub('District - ', '', Name))
religion.data <- religion.clean.data %>%
group_by(district) %>%
mutate(prop = TOT_P / sum(TOT_P)) %>%
dplyr::select(district,
religion = Religion,
urban.rural = TRU,
n = TOT_P,
prop)
religion.data
table(religion.data$district)
religion.data %>%
group_by(district) %>%
dplyr::summarise(prop = sum(prop))
knitr::opts_chunk$set(echo = TRUE)
poverty.data <- read.csv(
"Data/US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
poverty.data <- read.csv(
"US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
dim(poverty.data)[2]
dim(poverty.data)[1]
library(scales)
religion.data %>%
group_by(urban.rural, religion) %>% # group by urban/rural and religion
dplyr::summarise(n = sum(n)) %>%  # cacl sum of population for each religion- urban/rural grouo
group_by(religion) %>%  # then group by religion
mutate(p = n / sum(n)) %>%  # calc proportion of population of each grouop
filter(urban.rural == 'Urban') %>% # since we've calculated
ungroup() %>%
mutate(religion = reorder(religion, p)) %>%  #this puts it in decreasing order
###ABOVE shows what proportion of each religion is urban and rural so you can see the distirbution
ggplot(aes(x = p, y = religion)) +
geom_col(size = .5,  colour = 'white', fill = 'black') +
geom_text(aes(label = round(100*p, 1)),
position=position_stack(reverse=FALSE), hjust = 1.5,
show.legend=FALSE,
size = 2,
color="white") +
geom_vline(xintercept = 0) +
scale_x_continuous(labels = percent_format(accuracy = 1)) +
labs(title = 'How urban are the adherents of different religions?') +
theme_minimal() +
ggplot2::theme(plot.title = element_text(size = 10, hjust = 0),
panel.border = element_blank(),
panel.grid = element_blank(),
axis.title = element_blank(),
axis.text = element_text(size = 8))
hhi.data <- religion.data %>%
group_by(district, religion) %>%
dplyr::summarise(n = sum(n)) %>%
group_by(district) %>%
mutate(p = n / sum(n)) %>%
dplyr::summarise(hhi = sum((p * 100)^2))
ggplot(hhi.data, aes(hhi)) +
geom_histogram(fill = 'black') +
labs(title = 'Distribution of religious\nhomogeneity by district',
x = 'Herfindahl-Herschman Index scores') +
theme_minimal() +
theme(axis.title.y = element_blank())
knitr::opts_chunk$set(echo = TRUE)
poverty.data <- read.csv(
"US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
poverty.data <- read.csv(
"US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
knitr::opts_chunk$set(echo = TRUE)
dim(poverty.data)[2]
dim(poverty.data)[1]
names(poverty.data)[3]
names(drugs.mort.data)[2]
drugs.mort.data <- read.table(
"Data/US data for group task/mortality/Drugs and alcohol Cause of Death, 1999-2016.txt",
sep = '\t', header = T)
drugs.mort.data <- read.table(
"US data for group task/mortality/Drugs and alcohol Cause of Death, 1999-2016.txt",
sep = '\t', header = T)
names(poverty.data)[3]
names(drugs.mort.data)[2]
head(poverty.data$Id2)
head(drugs.mort.data$County.Code)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
patterns <- c(' County| Parish| city| Borough| Census Area')
county.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate))
head(county.data)
levels(as.factor(county.data$mortality.rate))
county.data <- county.data %>%
mutate(mortality.rate = ifelse(mortality.rate == 'Unreliable',
NA, as.numeric(as.character(mortality.rate))))
opioids.data <- read.csv("Data/US data for group task/opioids/opioids prescribing rates.csv")
opioids.data <- read.csv("US data for group task/opioids/opioids prescribing rates.csv")
county.data <- merge(
county.data  %>%
mutate(z.poverty = (below.poverty.rate - mean(below.poverty.rate, na.rm=T)) /
sd(below.poverty.rate, na.rm=T)),
opioids.data %>%
dplyr::rename(Id2 = FIPS.County.Code) %>%
mutate(z.opiates = (X2016.Prescribing.Rate - mean(X2016.Prescribing.Rate, na.rm=T)) /
sd(X2016.Prescribing.Rate, na.rm=T)) %>%
dplyr::select(Id2, z.opiates, X2016.Prescribing.Rate))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(sf)
us.shape.1 <-
st_read("US data for group task/US shapefiles/cb_2016_us_county_20m.shp")
fip.concordance <- read.csv("US data for group task/fips concordance.csv")
us.shape.2 <- us.shape.1 %>%
merge(fip.concordance %>%
mutate(STATEFP =  ifelse(Numeric.code >= 0 & Numeric.code <= 9,
paste0(0 , Numeric.code), Numeric.code)) %>%
dplyr::rename(state = Alpha.code))
us.shape.2$county <- paste0(us.shape.2$NAME, ", ", us.shape.2$state)
us.shape.2$county <- gsub("DoÃ±a Ana, NM", "Dona Ana, NM", us.shape.2$county)
us.shape.2$county <- gsub("LaSalle, LA", "La Salle, LA", us.shape.2$county)
us.shape.2$county <- gsub("Oglala Lakota, SD", "Oglala, SD", us.shape.2$county)
us.shape.2 <- full_join(us.shape.2,
county.data %>%
dplyr::select(county, below.poverty.rate, mortality.rate, X2016.Prescribing.Rate))
View(poverty.data)
View(drugs.mort.data)
View(opioids.data)
View(poverty.data)
head(county.data)
View(county.data)
levels(as.factor(county.data$mortality.rate))
county.data <- county.data %>%
mutate(mortality.rate = ifelse(mortality.rate == 'Unreliable',
NA, as.numeric(as.character(mortality.rate))))
county.data = drop_na(county.data, mortality.rate)
other.data <- load(
"US data for group task/Other census data/county.data.RData")
View(county.data)
View(poverty.data)
View(poverty.data)
poverty.data <- read.csv(
"US data for group task/poverty/poverty data - ACS_16_5YR_S1702_with_ann.csv",
skip = 1, header = T)
drugs.mort.data <- read.table(
"US data for group task/mortality/Drugs and alcohol Cause of Death, 1999-2016.txt",
sep = '\t', header = T)
opioids.data <- read.csv("US data for group task/opioids/opioids prescribing rates.csv")
patterns <- c(' County| Parish| city| Borough| Census Area')
main.data <- merge(
poverty.data %>%
dplyr::rename(below.poverty.rate =
All.families....Percent.below.poverty.level..Estimate..Families)  %>%
dplyr::select(Id2, below.poverty.rate),
drugs.mort.data %>%
dplyr::rename(Id2 = County.Code,
mortality.rate = Crude.Rate) %>%
mutate(county = gsub(patterns, "", County))  %>%
dplyr::select(Id2, county, mortality.rate))
head(main.data)
levels(as.factor(main.data$mortality.rate))
main.data <- main.data %>%
mutate(mortality.rate = ifelse(mortality.rate == 'Unreliable',
NA, as.numeric(as.character(mortality.rate))))
main.data <- merge(
main.data  %>%
mutate(z.poverty = (below.poverty.rate - mean(below.poverty.rate, na.rm=T)) /
sd(below.poverty.rate, na.rm=T)),
opioids.data %>%
dplyr::rename(Id2 = FIPS.County.Code) %>%
mutate(z.opiates = (X2016.Prescribing.Rate - mean(X2016.Prescribing.Rate, na.rm=T)) /
sd(X2016.Prescribing.Rate, na.rm=T)) %>%
dplyr::select(Id2, z.opiates, X2016.Prescribing.Rate))
us.shape.2 <- full_join(us.shape.2,
main.data %>%
dplyr::select(county, below.poverty.rate, mortality.rate, X2016.Prescribing.Rate))
main.data = drop_na(county.data, mortality.rate)
main.data = drop_na(main.data, mortality.rate)
View(main.data)
View(opioids.data)
View(county.data)
